---
title: Edit & Delete Posts - Inline Editing & Soft Deletion
description: Master inline form transformation, edit history tracking, soft vs hard deletion, permission checks, and edit windows. Build production-ready post editing.
---

# Disclaimer

:::u-alert
---
title: Comments in the code are for educational purposes only.
description: In real projects, avoid adding irrelevant or redundant comments.
color: warning
variant: subtle
icon: i-lucide-triangle-alert
---
:::

Editing and deleting posts introduces complex UX patterns: **inline editing** (transforming a post into a form), **soft deletion** (hiding without destroying data), **edit history** (tracking changes), **permission checks** (only author can edit), and **edit windows** (time limits for editing).

---

## What We're Building

Post editing with:
- **Inline editing**: Post transforms into editable form
- **Soft deletion**: Mark as deleted, preserve in database
- **Edit history**: Track all changes with timestamps
- **Permission checks**: Only author or admin can edit
- **Edit window**: 15-minute window to edit after posting
- **Change indicators**: Show "(edited)" badge with timestamp
- **Confirmation dialogs**: Warn before discarding changes
- **Markdown support**: Full editor with preview

**Visual Flow:**
```
Post by @alice (2 minutes ago)
"How do I learn React?"
[Edit] [Delete]

User clicks Edit â†’

Post by @alice (2 minutes ago) (EDITING)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Markdown Editor]                   â”‚
â”‚ How do I learn React?               â”‚
â”‚                                     â”‚
â”‚ [Preview] [Cancel] [Save Changes]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User saves â†’

Post by @alice (2 minutes ago) (edited just now)
"How do I learn React? [Updated content]"
[Edit History]
```

---

## The Challenge: Inline vs Modal Editing

### Two Approaches

**Approach 1: Modal Form** âŒ
```tsx
<button onClick={() => setShowModal(true)}>Edit</button>
<Modal><EditForm /></Modal>
```

**Problems:**
- Loses context (can't see surrounding posts)
- Disruptive (modal takes over screen)
- Extra UI layer (more clicks)

**Approach 2: Inline Form** âœ…
```tsx
{isEditing ? (
  <EditForm />
) : (
  <PostContent />
)}
```

**Benefits:**
- Context preserved (see conversation flow)
- Non-disruptive (stays in place)
- Fewer clicks (direct transformation)
- Better mobile UX (no modal overlay)

---

## Permission System

### Who Can Edit/Delete?

```typescript
interface EditPermissions {
  canEdit: boolean
  canDelete: boolean
  reason?: string
}

function getEditPermissions(post: Post, user: User | null): EditPermissions {
  // Not logged in
  if (!user) {
    return {
      canEdit: false,
      canDelete: false,
      reason: 'You must be logged in',
    }
  }

  // Admins can do anything
  if (user.role === 'admin') {
    return {
      canEdit: true,
      canDelete: true,
    }
  }

  // Not the author
  if (post.authorId !== user.id) {
    return {
      canEdit: false,
      canDelete: false,
      reason: 'Only the author can edit this post',
    }
  }

  // Check edit window (15 minutes)
  const fifteenMinutesAgo = Date.now() - 15 * 60 * 1000
  const postTimestamp = new Date(post.createdAt).getTime()
  const withinWindow = postTimestamp > fifteenMinutesAgo

  if (!withinWindow) {
    return {
      canEdit: false,
      canDelete: false,
      reason: 'Edit window expired (15 minutes)',
    }
  }

  // Author within edit window
  return {
    canEdit: true,
    canDelete: true,
  }
}
```

---

## Edit Post Component

```tsx
// src/components/posts/EditablePost.tsx

import { useState } from 'react'
import { useForm } from 'react-hook-form'
import { zodResolver } from '@hookform/resolvers/zod'
import { z } from 'zod'
import { MarkdownEditor } from '@/components/ui/MarkdownEditor'
import { apiClient } from '@/lib/api-client'
import { toast } from '@/lib/toast'
import { useAuth } from '@/contexts/AuthContext'
import type { Post } from '@/types'

const editPostSchema = z.object({
  content: z
    .string()
    .trim()
    .min(10, 'Post must be at least 10 characters')
    .max(10000, 'Post must be less than 10,000 characters'),
})

type EditPostInput = z.infer<typeof editPostSchema>

interface EditablePostProps {
  post: Post
  onUpdate: (post: Post) => void
  onDelete: () => void
}

/**
 * EditablePost - Post with inline editing
 * 
 * States:
 * - VIEW: Show post content with edit/delete buttons
 * - EDIT: Show inline form to edit content
 * - CONFIRM_DELETE: Show confirmation dialog
 * 
 * Features:
 * - Inline editing (post transforms into form)
 * - Permission checks (only author or admin)
 * - Edit window enforcement (15 minutes)
 * - Soft deletion (mark as deleted, preserve data)
 * - Edit history tracking
 * - Change confirmation (warn before discarding)
 */
export function EditablePost({ post, onUpdate, onDelete }: EditablePostProps) {
  const { user } = useAuth()
  const [isEditing, setIsEditing] = useState(false)
  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false)
  const [showPreview, setShowPreview] = useState(false)

  /**
   * Check permissions
   */
  const permissions = getEditPermissions(post, user)

  /**
   * Form setup
   */
  const {
    register,
    handleSubmit,
    watch,
    formState: { errors, isSubmitting, isDirty },
    reset,
  } = useForm<EditPostInput>({
    resolver: zodResolver(editPostSchema),
    defaultValues: {
      content: post.content,
    },
  })

  const content = watch('content')

  /**
   * Handle edit submission
   */
  const onSubmit = async (data: EditPostInput) => {
    try {
      const response = await apiClient.put<Post>(`/posts/${post.id}`, {
        content: data.content,
      })

      toast.success('Post updated!')
      setIsEditing(false)
      onUpdate(response.data)
    } catch (error) {
      toast.error('Failed to update post')
    }
  }

  /**
   * Handle cancel
   * 
   * If changes made, confirm before discarding
   */
  const handleCancel = () => {
    if (isDirty) {
      if (!window.confirm('Discard changes?')) {
        return
      }
    }

    reset()
    setIsEditing(false)
  }

  /**
   * Handle delete
   * 
   * Soft delete: Mark as deleted, preserve in DB
   */
  const handleDelete = async () => {
    try {
      await apiClient.delete(`/posts/${post.id}`)
      toast.success('Post deleted')
      onDelete()
    } catch (error) {
      toast.error('Failed to delete post')
    }
  }

  /**
   * EDIT MODE: Show inline form
   */
  if (isEditing) {
    return (
      <div className="p-4 bg-slate-900 rounded-lg border border-blue-600">
        {/* Editing indicator */}
        <div className="mb-3 text-sm text-blue-400">
          Editing post...
        </div>

        {/* Form */}
        <form onSubmit={handleSubmit(onSubmit)} className="space-y-4">
          <div>
            <MarkdownEditor
              value={content}
              onChange={(value) => register('content').onChange({ target: { value } })}
              placeholder="Edit your post..."
              showPreview={showPreview}
              minHeight={120}
            />

            {errors.content && (
              <p className="mt-2 text-sm text-red-400">
                {errors.content.message}
              </p>
            )}
          </div>

          {/* Actions */}
          <div className="flex items-center justify-between">
            <button
              type="button"
              onClick={() => setShowPreview(!showPreview)}
              className="text-sm text-slate-400 hover:text-slate-200"
            >
              {showPreview ? 'âœï¸ Edit' : 'ğŸ‘ï¸ Preview'}
            </button>

            <div className="flex gap-3">
              <button
                type="button"
                onClick={handleCancel}
                className="px-4 py-2 bg-slate-800 text-slate-200 rounded-lg hover:bg-slate-700"
              >
                Cancel
              </button>

              <button
                type="submit"
                disabled={isSubmitting || !isDirty}
                className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50"
              >
                {isSubmitting ? 'Saving...' : 'Save Changes'}
              </button>
            </div>
          </div>
        </form>
      </div>
    )
  }

  /**
   * VIEW MODE: Show post content
   */
  return (
    <div className="p-4 bg-slate-900 rounded-lg border border-slate-800">
      {/* Post Header */}
      <div className="flex items-start justify-between mb-3">
        <div>
          <span className="font-medium text-slate-100">
            {post.author.username}
          </span>
          <span className="mx-2 text-slate-600">â€¢</span>
          <span className="text-sm text-slate-500">
            {formatRelativeTime(post.createdAt)}
          </span>

          {/* Edited indicator */}
          {post.editedAt && (
            <>
              <span className="mx-2 text-slate-600">â€¢</span>
              <span className="text-xs text-slate-500">
                (edited {formatRelativeTime(post.editedAt)})
              </span>
            </>
          )}
        </div>

        {/* Action buttons */}
        {permissions.canEdit && (
          <div className="flex gap-2">
            <button
              onClick={() => setIsEditing(true)}
              className="text-sm text-slate-400 hover:text-blue-400"
              title="Edit post"
            >
              Edit
            </button>

            {permissions.canDelete && (
              <button
                onClick={() => setShowDeleteConfirm(true)}
                className="text-sm text-slate-400 hover:text-red-400"
                title="Delete post"
              >
                Delete
              </button>
            )}
          </div>
        )}
      </div>

      {/* Post Content */}
      {post.isDeleted ? (
        <p className="text-slate-500 italic">[deleted]</p>
      ) : (
        <div
          className="prose prose-invert max-w-none"
          dangerouslySetInnerHTML={{ __html: post.contentHtml }}
        />
      )}

      {/* Delete Confirmation */}
      {showDeleteConfirm && (
        <div className="mt-4 p-4 bg-red-900/20 border border-red-800 rounded-lg">
          <p className="text-sm text-slate-200 mb-3">
            Are you sure you want to delete this post? This action cannot be undone.
          </p>
          <div className="flex gap-3">
            <button
              onClick={() => setShowDeleteConfirm(false)}
              className="px-4 py-2 bg-slate-800 text-slate-200 rounded-lg hover:bg-slate-700"
            >
              Cancel
            </button>
            <button
              onClick={handleDelete}
              className="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700"
            >
              Delete Post
            </button>
          </div>
        </div>
      )}
    </div>
  )
}

/**
 * Format relative time
 */
function formatRelativeTime(timestamp: string): string {
  const seconds = Math.floor(
    (Date.now() - new Date(timestamp).getTime()) / 1000
  )

  if (seconds < 60) return 'just now'
  if (seconds < 3600) return `${Math.floor(seconds / 60)} minutes ago`
  if (seconds < 86400) return `${Math.floor(seconds / 3600)} hours ago`
  return `${Math.floor(seconds / 86400)} days ago`
}
```

---

## Edit History Tracking

```tsx
// src/features/posts/components/EditHistory.tsx

interface PostEdit {
  id: string
  postId: string
  content: string
  editedBy: {
    id: string
    username: string
  }
  editedAt: string
}

interface EditHistoryProps {
  postId: string
}

/**
 * EditHistory - Show all edits to a post
 * 
 * Features:
 * - Timeline of changes
 * - Diff view (show what changed)
 * - Revert to previous version
 * - Editor attribution
 */
export function EditHistory({ postId }: EditHistoryProps) {
  const [history, setHistory] = useState<PostEdit[]>([])
  const [isLoading, setIsLoading] = useState(true)

  useEffect(() => {
    fetchHistory()
  }, [postId])

  const fetchHistory = async () => {
    try {
      const response = await apiClient.get<PostEdit[]>(
        `/posts/${postId}/history`
      )
      setHistory(response.data)
    } finally {
      setIsLoading(false)
    }
  }

  if (isLoading) return <div>Loading history...</div>

  return (
    <div className="space-y-4">
      <h3 className="text-lg font-semibold">Edit History</h3>

      {history.map((edit, index) => (
        <div
          key={edit.id}
          className="p-4 bg-slate-900 rounded-lg border border-slate-800"
        >
          <div className="flex items-center justify-between mb-2">
            <div className="text-sm">
              <span className="text-slate-400">Edited by</span>{' '}
              <span className="text-blue-400 font-medium">
                @{edit.editedBy.username}
              </span>
              <span className="mx-2 text-slate-600">â€¢</span>
              <span className="text-slate-500">
                {formatRelativeTime(edit.editedAt)}
              </span>
            </div>

            {index === 0 && (
              <span className="text-xs px-2 py-1 bg-blue-600/20 text-blue-400 rounded">
                Current
              </span>
            )}
          </div>

          <div className="text-sm text-slate-300">
            {edit.content.slice(0, 200)}
            {edit.content.length > 200 && '...'}
          </div>
        </div>
      ))}
    </div>
  )
}
```

---

## Summary

### Key Patterns Learned

1. **Inline Editing**: Transform component between states
   ```tsx
   {isEditing ? <EditForm /> : <PostContent />}
   ```

2. **Permission System**: Check user, role, and time window
   ```tsx
   const canEdit = isAuthor && withinTimeWindow
   ```

3. **Soft Deletion**: Mark as deleted, preserve data
   ```tsx
   isDeleted ? <span>[deleted]</span> : <Content />
   ```

4. **Edit History**: Track all changes with attribution
   - Who edited
   - When edited
   - What changed

5. **Confirmation Dialogs**: Prevent accidental data loss
   - Confirm before delete
   - Warn when discarding changes

### Best Practices

- âœ… Check permissions before showing edit buttons
- âœ… Enforce edit windows (prevent abuse)
- âœ… Use soft deletion (preserve history)
- âœ… Track edit history (transparency)
- âœ… Show "(edited)" indicator
- âœ… Confirm before destructive actions
- âœ… Inline editing for better UX
- âœ… Disable actions during submission

### Security Considerations

- ğŸ”’ Always check permissions on backend
- ğŸ”’ Don't trust client-side permission checks
- ğŸ”’ Validate edit window on server
- ğŸ”’ Log all edits for audit trail
- ğŸ”’ Rate limit edit requests
- ğŸ”’ Sanitize HTML output (XSS prevention)

---

## Posts Module Complete! ğŸ‰

You've mastered:
- âœ… Recursive nested posts
- âœ… Inline reply composition
- âœ… Optimistic vote system
- âœ… Inline editing with history
- âœ… Soft deletion
- âœ… Permission checks

---

Next: [Auth Module â†’](/en/react/7.auth-module/1.signup-signin)
