---
title: P√°gina de Detalle de Hilo
description: Domina useParams para rutas din√°micas, obtenci√≥n de datos paralela y visualizaci√≥n de datos anidados.
---

# Disclaimer

:::u-alert
---
title: Los comentarios en el c√≥digo son solo educativos.
description: En proyectos reales, evita comentarios irrelevantes o redundantes.
color: warning
variant: subtle
icon: i-lucide-triangle-alert
---
:::

La p√°gina de detalle de hilo es el coraz√≥n de nuestro foro. Muestra el contenido del hilo, todas las respuestas y permite a los usuarios participar en la discusi√≥n.

---

## Lo Que Estamos Construyendo

Una p√°gina de detalle de hilo con:
- T√≠tulo, autor, categor√≠a del hilo
- Contenido del post original (markdown renderizado)
- Lista de todas las respuestas (anidadas)
- Compositor de respuestas
- Botones de voto
- Acciones de editar/eliminar (para el autor)

---

## React Router: Rutas Din√°micas

React Router nos permite definir rutas con par√°metros.

```tsx
// src/App.tsx

import { BrowserRouter, Routes, Route } from 'react-router-dom'

function App() {
  return (
    <BrowserRouter>
      <Routes>
        <Route path="/" element={<HomePage />} />
        <Route path="/threads" element={<ThreadsPage />} />
        {/* Ruta din√°mica con par√°metro :slug */}
        <Route path="/threads/:slug" element={<ThreadDetailPage />} />
      </Routes>
    </BrowserRouter>
  )
}
```

**Par√°metros de ruta:**
- `/threads/:slug` coincide con `/threads/como-usar-react`
- `:slug` es un **par√°metro** (parte variable de la URL)
- Podemos tener m√∫ltiples par√°metros: `/users/:userId/posts/:postId`

---

## useParams: Accediendo a Par√°metros de Ruta

El hook `useParams` extrae par√°metros de la URL actual.

```tsx
import { useParams } from 'react-router-dom'

function ThreadDetailPage() {
  // Extraer slug de la URL
  const { slug } = useParams<{ slug: string }>()
  
  console.log(slug)  // "como-usar-react"
  
  // Usar slug para obtener datos del hilo
}
```

**Seguridad de tipos con TypeScript:**
```tsx
// ‚úÖ Par√°metros con seguridad de tipos
const { slug } = useParams<{ slug: string }>()
slug.toUpperCase()  // TypeScript sabe que es un string

// ‚ùå Sin tipo
const params = useParams()
params.slug.toUpperCase()  // Error: slug podr√≠a ser undefined
```

**M√∫ltiples par√°metros:**
```tsx
const { userId, postId } = useParams<{ userId: string; postId: string }>()
```

---

## Estructura de la P√°gina de Detalle de Hilo

```tsx
// src/pages/ThreadDetailPage.tsx

import { useState, useEffect } from 'react'
import { useParams, useNavigate } from 'react-router-dom'
import { apiClient } from '@/lib/api-client'
import { ThreadHeader } from '@/components/threads/ThreadHeader'
import { PostList } from '@/components/posts/PostList'
import { ReplyComposer } from '@/components/posts/ReplyComposer'
import type { Thread, Post } from '@/types'

export function ThreadDetailPage() {
  /**
   * useParams: Obtener slug de la URL
   * 
   * URL: /threads/como-usar-react
   * slug: "como-usar-react"
   */
  const { slug } = useParams<{ slug: string }>()
  const navigate = useNavigate()
  
  /**
   * Estado para hilo y posts
   * 
   * Estado separado porque se obtienen de diferentes endpoints
   */
  const [thread, setThread] = useState<Thread | null>(null)
  const [posts, setPosts] = useState<Post[]>([])
  const [isLoading, setIsLoading] = useState(true)
  const [error, setError] = useState<string | null>(null)

  /**
   * Obtener hilo y posts cuando el componente se monta o el slug cambia
   * 
   * Dependencias: [slug]
   * ¬øPor qu√©? Si el usuario navega a un hilo diferente, necesitamos obtener nuevos datos
   */
  useEffect(() => {
    /**
     * Funci√≥n as√≠ncrona para obtener hilo y posts en paralelo
     * 
     * Promise.all ejecuta solicitudes concurrentemente (m√°s r√°pido que secuencial)
     */
    async function fetchThreadData() {
      try {
        setIsLoading(true)
        setError(null)

        /**
         * Promise.all: Esperar a que todas las promesas se resuelvan
         * 
         * Beneficios:
         * - Ejecuci√≥n paralela (m√°s r√°pido que await uno, luego await otro)
         * - Si alguna falla, todas fallan (operaci√≥n at√≥mica)
         */
        const [threadResponse, postsResponse] = await Promise.all([
          apiClient.get<Thread>(`/threads/${slug}`),
          apiClient.get<Post[]>(`/threads/${slug}/posts`),
        ])

        setThread(threadResponse.data)
        setPosts(postsResponse.data)

        /**
         * Incrementar conteo de vistas (fire and forget)
         * 
         * No await porque no nos importa la respuesta
         * El usuario no deber√≠a esperar que el conteo de vistas se incremente
         */
        apiClient.post(`/threads/${slug}/views`).catch(() => {
          // Ignorar errores (el conteo de vistas no es cr√≠tico)
        })
      } catch (err) {
        /**
         * Manejar diferentes tipos de error
         */
        if (err.response?.status === 404) {
          setError('Hilo no encontrado')
        } else {
          setError(err instanceof Error ? err.message : 'Fall√≥ cargar hilo')
        }
      } finally {
        setIsLoading(false)
      }
    }

    fetchThreadData()
  }, [slug])

  /**
   * Manejar env√≠o de nueva respuesta
   * 
   * Agregar optimistamente respuesta a la UI antes de que la API confirme
   */
  const handleReplyCreated = (newPost: Post) => {
    setPosts((prevPosts) => [...prevPosts, newPost])
  }

  /**
   * Estado de carga: Mostrar skeleton
   */
  if (isLoading) {
    return (
      <div className="container mx-auto px-4 py-8 max-w-4xl">
        <ThreadDetailSkeleton />
      </div>
    )
  }

  /**
   * Estado de error: Mostrar mensaje de error
   */
  if (error) {
    return (
      <div className="container mx-auto px-4 py-8 max-w-4xl">
        <div className="bg-red-900/20 border border-red-700 rounded-lg p-6 text-center">
          <h2 className="text-xl font-bold text-red-400 mb-2">Error</h2>
          <p className="text-red-300 mb-4">{error}</p>
          <button
            onClick={() => navigate('/threads')}
            className="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700"
          >
            Volver a Hilos
          </button>
        </div>
      </div>
    )
  }

  /**
   * Estado de √©xito: Mostrar hilo y posts
   */
  if (!thread) {
    return null  // No deber√≠a pasar, pero hace feliz a TypeScript
  }

  return (
    <div className="container mx-auto px-4 py-8 max-w-4xl">
      {/* Encabezado del hilo con t√≠tulo, autor, categor√≠a */}
      <ThreadHeader thread={thread} />

      {/* Divisor */}
      <div className="border-t border-slate-800 my-8" />

      {/* Lista de posts (respuestas anidadas) */}
      <PostList posts={posts} threadId={thread.id} />

      {/* Compositor de respuestas (solo para usuarios autenticados) */}
      <div className="mt-8">
        <ReplyComposer
          threadId={thread.id}
          onReplyCreated={handleReplyCreated}
        />
      </div>
    </div>
  )
}
```

---

## Promise.all: Obtenci√≥n Paralela

**Secuencial (lento):**
```tsx
// Toma 2 segundos si cada solicitud toma 1 segundo
const threadResponse = await apiClient.get(`/threads/${slug}`)
const postsResponse = await apiClient.get(`/threads/${slug}/posts`)
```

**Paralelo (r√°pido):**
```tsx
// Toma 1 segundo (ambas solicitudes se ejecutan simult√°neamente)
const [threadResponse, postsResponse] = await Promise.all([
  apiClient.get(`/threads/${slug}`),
  apiClient.get(`/threads/${slug}/posts`),
])
```

**Cu√°ndo usar Promise.all:**
- ‚úÖ Las solicitudes son independientes (no dependen unas de otras)
- ‚úÖ Necesitas todos los resultados antes de proceder
- ‚úÖ El rendimiento importa

**Cu√°ndo NO usar:**
- ‚ùå La segunda solicitud necesita datos de la primera
- ‚ùå Las solicitudes son opcionales (usa Promise.allSettled en su lugar)

---

## Componente de Encabezado de Hilo

```tsx
// src/components/threads/ThreadHeader.tsx

import { Link } from 'react-router-dom'
import { formatDistanceToNow } from 'date-fns'
import { CategoryBreadcrumb } from '@/components/categories/CategoryBreadcrumb'
import type { Thread } from '@/types'

interface ThreadHeaderProps {
  thread: Thread
}

export function ThreadHeader({ thread }: ThreadHeaderProps) {
  return (
    <header>
      {/* Navegaci√≥n de breadcrumbs */}
      <nav className="mb-4">
        <CategoryBreadcrumb categoryId={thread.categoryId} />
      </nav>

      {/* T√≠tulo del hilo */}
      <h1 className="text-4xl font-bold text-slate-100 mb-4">
        {thread.isPinned && (
          <span className="text-yellow-500 mr-2" title="Hilo fijado">
            üìå
          </span>
        )}
        {thread.isLocked && (
          <span className="text-slate-500 mr-2" title="Hilo bloqueado">
            üîí
          </span>
        )}
        {thread.title}
      </h1>

      {/* Metadatos del hilo */}
      <div className="flex items-center gap-4 text-sm text-slate-400">
        {/* Autor */}
        <div className="flex items-center gap-2">
          <img
            src={thread.author.avatarUrl || '/avatars/default.png'}
            alt={thread.author.displayName}
            className="w-8 h-8 rounded-full"
          />
          <Link
            to={`/users/${thread.author.username}`}
            className="font-medium text-slate-200 hover:text-blue-400"
          >
            {thread.author.displayName}
          </Link>
        </div>

        <span>‚Ä¢</span>

        {/* Tiempo de creaci√≥n */}
        <time dateTime={thread.createdAt}>
          {formatDistanceToNow(new Date(thread.createdAt), { addSuffix: true })}
        </time>

        <span>‚Ä¢</span>

        {/* Estad√≠sticas */}
        <span>üëÅ {thread.viewCount} vistas</span>
        <span>üí¨ {thread.replyCount} respuestas</span>
      </div>

      {/* Contenido del hilo (primer post) */}
      <div className="mt-6 p-6 bg-slate-900 rounded-lg border border-slate-800">
        <div
          className="prose prose-invert max-w-none"
          dangerouslySetInnerHTML={{ __html: thread.contentHtml }}
        />
      </div>
    </header>
  )
}
```

---

## Componente de Lista de Posts

```tsx
// src/components/posts/PostList.tsx

import { PostCard } from './PostCard'
import type { Post } from '@/types'

interface PostListProps {
  posts: Post[]
  threadId: string
}

export function PostList({ posts, threadId }: PostListProps) {
  if (posts.length === 0) {
    return (
      <div className="text-center py-12 bg-slate-900 rounded-lg border border-slate-800">
        <p className="text-slate-400">
          A√∫n no hay respuestas. ¬°S√© el primero en responder!
        </p>
      </div>
    )
  }

  /**
   * Filtrar posts ra√≠z (sin padre)
   * 
   * Las respuestas anidadas se renderizan recursivamente por PostCard
   */
  const rootPosts = posts.filter((post) => post.parentId === null)

  return (
    <div className="space-y-6">
      <h2 className="text-2xl font-bold text-slate-100">
        Respuestas ({posts.length})
      </h2>

      <div className="space-y-4">
        {rootPosts.map((post) => (
          <PostCard
            key={post.id}
            post={post}
            allPosts={posts}  // Necesario para encontrar hijos
            threadId={threadId}
          />
        ))}
      </div>
    </div>
  )
}
```

---

## Skeleton de Carga

```tsx
// src/components/threads/ThreadDetailSkeleton.tsx

export function ThreadDetailSkeleton() {
  return (
    <div className="animate-pulse space-y-6">
      {/* Skeleton de breadcrumb */}
      <div className="flex gap-2">
        <div className="h-4 bg-slate-800 rounded w-20" />
        <div className="h-4 bg-slate-800 rounded w-4" />
        <div className="h-4 bg-slate-800 rounded w-32" />
      </div>

      {/* Skeleton de t√≠tulo */}
      <div className="h-10 bg-slate-800 rounded w-3/4" />

      {/* Skeleton de metadatos */}
      <div className="flex gap-4">
        <div className="h-8 w-8 bg-slate-800 rounded-full" />
        <div className="h-4 bg-slate-800 rounded w-32" />
      </div>

      {/* Skeleton de contenido */}
      <div className="p-6 bg-slate-900 rounded-lg border border-slate-800 space-y-3">
        <div className="h-4 bg-slate-800 rounded w-full" />
        <div className="h-4 bg-slate-800 rounded w-5/6" />
        <div className="h-4 bg-slate-800 rounded w-4/6" />
      </div>

      {/* Skeleton de posts */}
      <div className="space-y-4">
        {[...Array(3)].map((_, i) => (
          <div
            key={i}
            className="p-4 bg-slate-900 rounded-lg border border-slate-800 space-y-3"
          >
            <div className="flex gap-2">
              <div className="h-8 w-8 bg-slate-800 rounded-full" />
              <div className="h-4 bg-slate-800 rounded w-24" />
            </div>
            <div className="space-y-2">
              <div className="h-4 bg-slate-800 rounded w-full" />
              <div className="h-4 bg-slate-800 rounded w-3/4" />
            </div>
          </div>
        ))}
      </div>
    </div>
  )
}
```

---

## Estrategias de Manejo de Errores

**Diferentes tipos de error:**

```tsx
try {
  const response = await apiClient.get(`/threads/${slug}`)
} catch (err) {
  // 404: Hilo no encontrado
  if (err.response?.status === 404) {
    setError('Hilo no encontrado')
  }
  
  // 403: Acceso denegado (hilo privado)
  else if (err.response?.status === 403) {
    setError('No tienes permiso para ver este hilo')
  }
  
  // 500: Error del servidor
  else if (err.response?.status >= 500) {
    setError('Error del servidor. Por favor intenta m√°s tarde.')
  }
  
  // Error de red
  else if (!err.response) {
    setError('Error de red. Verifica tu conexi√≥n.')
  }
  
  // Otros errores
  else {
    setError('Fall√≥ cargar hilo')
  }
}
```

---

## Resumen

### Nuevos Conceptos Aprendidos

1. **useParams**: Extraer par√°metros de la URL
   ```tsx
   const { slug } = useParams<{ slug: string }>()
   ```

2. **Promise.all**: Solicitudes paralelas
   ```tsx
   const [a, b] = await Promise.all([fetchA(), fetchB()])
   ```

3. **Solicitudes fire-and-forget**: No bloquear la UI
   ```tsx
   apiClient.post('/track-view').catch(() => {})  // No await
   ```

4. **Manejo de errores**: Diferentes respuestas para diferentes errores

5. **Skeleton de carga**: Mejor UX que spinner

### Mejores Pr√°cticas

- ‚úÖ Obtener datos en paralelo cuando sea posible
- ‚úÖ Mostrar mensajes de error detallados
- ‚úÖ Usar skeleton de carga para mejor rendimiento percibido
- ‚úÖ Rastrear anal√≠ticas as√≠ncronamente (no bloquear la UI)
- ‚úÖ Manejar errores 404, 403, 500 de manera diferente
- ‚úÖ Proporcionar forma de volver atr√°s en caso de error

---

## Pr√≥ximos Pasos

Ahora que podemos mostrar hilos, aprendamos c√≥mo **crearlos** con un editor de markdown rico.

Contin√∫a a [Crear Hilo ‚Üí](/es/react/5.threads-module/3.create-thread)
