---
title: Categor√≠as Anidadas
description: Domina la recursi√≥n en React para mostrar √°rboles jer√°rquicos de categor√≠as.
---

# Disclaimer

:::u-alert
---
title: Los comentarios en el c√≥digo son solo educativos.
description: En proyectos reales, evita comentarios irrelevantes o redundantes.
color: warning
variant: subtle
icon: i-lucide-triangle-alert
---
:::

Las categor√≠as pueden estar anidadas (subcategor√≠as). Usamos **recursi√≥n** para renderizar estructuras de √°rbol.

---

## Estructura de √Årbol

```
üìÅ Soporte T√©cnico (padre)
  ‚îú‚îÄ üìÅ Reportes de Bugs (hijo)
  ‚îú‚îÄ üìÅ Solicitudes de Funcionalidades (hijo)
  ‚îî‚îÄ üìÅ Ayuda de Instalaci√≥n (hijo)
      ‚îî‚îÄ üìÅ Windows (nieto)
```

Cada categor√≠a tiene un `parentId` que referencia a su padre.

---

## Recursi√≥n: El Patr√≥n

**Recursi√≥n** = funci√≥n que se llama a s√≠ misma.

**Requisitos:**
1. **Caso base**: Cu√°ndo detenerse
2. **Caso recursivo**: Llamarse a s√≠ misma con entrada m√°s simple

```tsx
// Ejemplo: Cuenta regresiva
function countdown(n: number) {
  if (n === 0) {
    console.log('¬°Listo!')  // Caso base
    return
  }
  
  console.log(n)
  countdown(n - 1)  // Caso recursivo
}

countdown(3)
// Salida: 3, 2, 1, ¬°Listo!
```

---

## Componente Recursivo

```tsx
// src/components/categories/CategoryTreeItem.tsx

import { Link } from 'react-router-dom'
import type { Category } from '@/types'

interface CategoryTreeItemProps {
  category: Category
  allCategories: Category[]  // Necesario para encontrar hijos
  level?: number  // Nivel de sangr√≠a
}

/**
 * Componente recursivo que renderiza una categor√≠a y sus hijos
 * 
 * C√≥mo funciona la recursi√≥n:
 * 1. Renderizar esta categor√≠a
 * 2. Encontrar sus hijos
 * 3. Renderizar recursivamente cada hijo (¬°se llama a s√≠ mismo!)
 * 4. Cada hijo repite los pasos 1-3
 */
export function CategoryTreeItem({
  category,
  allCategories,
  level = 0,
}: CategoryTreeItemProps) {
  /**
   * Encontrar hijos directos de esta categor√≠a
   * 
   * Hijo: categor√≠a donde parentId === id de esta categor√≠a
   */
  const children = allCategories.filter((cat) => cat.parentId === category.id)

  /**
   * Calcular sangr√≠a basada en la profundidad
   * 
   * Nivel 0: 0px
   * Nivel 1: 20px
   * Nivel 2: 40px
   */
  const indent = level * 20

  return (
    <div>
      {/* Esta categor√≠a */}
      <Link
        to={`/categories/${category.slug}`}
        className="block p-3 hover:bg-slate-800 rounded-md transition-colors"
        style={{ paddingLeft: `${indent + 12}px` }}  // Sangr√≠a din√°mica
      >
        <div className="flex items-center gap-2">
          {/* Icono */}
          <span className="text-lg">
            {children.length > 0 ? 'üìÅ' : 'üìÑ'}
          </span>

          {/* Nombre */}
          <span className="text-slate-100 font-medium">
            {category.name}
          </span>

          {/* Conteo de hilos */}
          <span className="text-xs text-slate-500 ml-auto">
            {category.threadCount}
          </span>
        </div>

        {/* Descripci√≥n */}
        {category.description && (
          <p className="text-sm text-slate-400 mt-1">
            {category.description}
          </p>
        )}
      </Link>

      {/* Hijos (LLAMADA RECURSIVA) */}
      {children.length > 0 && (
        <div>
          {children.map((child) => (
            <CategoryTreeItem
              key={child.id}
              category={child}
              allCategories={allCategories}
              level={level + 1}  // Aumentar profundidad
            />
          ))}
        </div>
      )}
    </div>
  )
}
```

### C√≥mo Funciona la Recursi√≥n Aqu√≠

**Ejecuci√≥n paso a paso:**

```tsx
// Llamada inicial
<CategoryTreeItem
  category={soporteTecnico}  // parentId: null
  allCategories={all}
  level={0}
/>

// Encuentra hijos: [reportesDeBugs, solicitudesDeFuncionalidades]

// Llama recursivamente a s√≠ mismo para cada hijo:
<CategoryTreeItem
  category={reportesDeBugs}  // parentId: soporteTecnico.id
  allCategories={all}
  level={1}
/>

// Y as√≠ sucesivamente...
```

**Traza visual:**

```
CategoryTreeItem(Soporte T√©cnico, level=0)
  ‚Üí Renderiza "Soporte T√©cnico"
  ‚Üí Encuentra hijos: [Reportes de Bugs, Solicitudes de Funcionalidades]
  ‚Üí Llama CategoryTreeItem(Reportes de Bugs, level=1)
      ‚Üí Renderiza "Reportes de Bugs" (sangrado)
      ‚Üí Encuentra hijos: []
      ‚Üí Hecho
  ‚Üí Llama CategoryTreeItem(Solicitudes de Funcionalidades, level=1)
      ‚Üí Renderiza "Solicitudes de Funcionalidades" (sangrado)
      ‚Üí Encuentra hijos: [Windows]
      ‚Üí Llama CategoryTreeItem(Windows, level=2)
          ‚Üí Renderiza "Windows" (m√°s sangrado)
          ‚Üí Encuentra hijos: []
          ‚Üí Hecho
      ‚Üí Hecho
  ‚Üí Hecho
```

---

## Componente de √Årbol de Categor√≠as

```tsx
// src/components/categories/CategoryTree.tsx

import { CategoryTreeItem } from './CategoryTreeItem'
import type { Category } from '@/types'

interface CategoryTreeProps {
  categories: Category[]
}

/**
 * Renderiza el √°rbol completo de categor√≠as
 * 
 * Solo renderiza categor√≠as ra√≠z (parentId === null)
 * Los hijos se renderizan recursivamente por CategoryTreeItem
 */
export function CategoryTree({ categories }: CategoryTreeProps) {
  /**
   * Encontrar categor√≠as ra√≠z (sin padre)
   */
  const rootCategories = categories.filter((cat) => cat.parentId === null)

  return (
    <div className="space-y-2">
      {rootCategories.map((category) => (
        <CategoryTreeItem
          key={category.id}
          category={category}
          allCategories={categories}
          level={0}
        />
      ))}
    </div>
  )
}
```

---

## √Årbol Contra√≠ble

Agregar funcionalidad de expandir/contraer.

```tsx
import { useState } from 'react'

export function CategoryTreeItem({
  category,
  allCategories,
  level = 0,
}: CategoryTreeItemProps) {
  const children = allCategories.filter((cat) => cat.parentId === category.id)
  
  /**
   * Rastrear estado expandido
   * 
   * Por defecto: expandido si tiene hijos
   */
  const [isExpanded, setIsExpanded] = useState(children.length > 0)

  const indent = level * 20

  return (
    <div>
      <div
        className="block p-3 hover:bg-slate-800 rounded-md transition-colors cursor-pointer"
        style={{ paddingLeft: `${indent + 12}px` }}
        onClick={() => setIsExpanded(!isExpanded)}
      >
        <div className="flex items-center gap-2">
          {/* Icono de expandir/contraer */}
          {children.length > 0 && (
            <button
              type="button"
              className="text-slate-400 hover:text-slate-200"
              onClick={(e) => {
                e.stopPropagation()  // No activar clic del padre
                setIsExpanded(!isExpanded)
              }}
            >
              {isExpanded ? '‚ñº' : '‚ñ∂'}
            </button>
          )}

          <span className="text-lg">
            {children.length > 0 ? 'üìÅ' : 'üìÑ'}
          </span>

          <Link
            to={`/categories/${category.slug}`}
            className="text-slate-100 font-medium hover:text-blue-400"
            onClick={(e) => e.stopPropagation()}  // No contraer al hacer clic en nombre
          >
            {category.name}
          </Link>

          <span className="text-xs text-slate-500 ml-auto">
            {category.threadCount}
          </span>
        </div>

        {category.description && (
          <p className="text-sm text-slate-400 mt-1">
            {category.description}
          </p>
        )}
      </div>

      {/* Solo mostrar hijos si est√° expandido */}
      {isExpanded && children.length > 0 && (
        <div>
          {children.map((child) => (
            <CategoryTreeItem
              key={child.id}
              category={child}
              allCategories={allCategories}
              level={level + 1}
            />
          ))}
        </div>
      )}
    </div>
  )
}
```

---

## Navegaci√≥n de Breadcrumbs

Mostrar jerarqu√≠a de categor√≠as como breadcrumbs.

```tsx
// src/components/categories/CategoryBreadcrumb.tsx

import { Link } from 'react-router-dom'
import type { Category } from '@/types'

interface CategoryBreadcrumbProps {
  category: Category
  allCategories: Category[]
}

/**
 * Construir ruta de breadcrumbs usando recursi√≥n
 * 
 * Empezar desde la categor√≠a actual, caminar hacia arriba hasta la ra√≠z
 */
export function CategoryBreadcrumb({
  category,
  allCategories,
}: CategoryBreadcrumbProps) {
  /**
   * Construir recursivamente la cadena de ancestros
   */
  function getAncestors(cat: Category): Category[] {
    if (!cat.parentId) {
      return [cat]  // Caso base: categor√≠a ra√≠z
    }

    const parent = allCategories.find((c) => c.id === cat.parentId)
    if (!parent) {
      return [cat]
    }

    // Caso recursivo: anteponer ancestros del padre
    return [...getAncestors(parent), cat]
  }

  const breadcrumbs = getAncestors(category)

  return (
    <nav className="flex items-center gap-2 text-sm" aria-label="Breadcrumb">
      <Link to="/categories" className="text-slate-400 hover:text-slate-200">
        Inicio
      </Link>

      {breadcrumbs.map((crumb, index) => (
        <div key={crumb.id} className="flex items-center gap-2">
          <span className="text-slate-600">/</span>
          
          {index === breadcrumbs.length - 1 ? (
            // √öltimo item: no es enlace
            <span className="text-slate-100 font-medium">
              {crumb.name}
            </span>
          ) : (
            // Ancestro: enlace
            <Link
              to={`/categories/${crumb.slug}`}
              className="text-slate-400 hover:text-slate-200"
            >
              {crumb.name}
            </Link>
          )}
        </div>
      ))}
    </nav>
  )
}
```

---

## Rendimiento: useMemo

Construir arrays de hijos en cada renderizado es costoso. Cachear con `useMemo`.

```tsx
import { useMemo } from 'react'

export function CategoryTreeItem({
  category,
  allCategories,
  level = 0,
}: CategoryTreeItemProps) {
  /**
   * useMemo: Cachear computaci√≥n costosa
   * 
   * Solo recalcular cuando cambien las dependencias
   */
  const children = useMemo(() => {
    return allCategories.filter((cat) => cat.parentId === category.id)
  }, [allCategories, category.id])

  // Resto del componente...
}
```

### useMemo Explicado

**Sin useMemo:**
```tsx
// Recalcula EN CADA renderizado (incluso si allCategories no cambi√≥)
const children = allCategories.filter((cat) => cat.parentId === category.id)
```

**Con useMemo:**
```tsx
// Solo recalcula cuando allCategories o category.id cambian
const children = useMemo(() => {
  return allCategories.filter((cat) => cat.parentId === category.id)
}, [allCategories, category.id])
```

**Cu√°ndo usar useMemo:**
- C√°lculos costosos (filtrar arrays grandes, matem√°ticas complejas)
- La igualdad referencial importa (pasar objetos a componentes hijos)

**Cu√°ndo NO usar:**
- C√°lculos simples (adici√≥n, concatenaci√≥n de strings)
- Optimizaci√≥n prematura

---

## Resumen

### Patr√≥n de Recursi√≥n
1. **Caso base**: Cu√°ndo detenerse (sin hijos)
2. **Caso recursivo**: Procesar actual + recursi√≥n en hijos
3. **Pasar estado hacia abajo**: Cada nivel necesita contexto (allCategories, level)

### Nuevos Conceptos
1. **Recursi√≥n en React**: Componente que se llama a s√≠ mismo
2. **Estructuras de √°rbol**: Datos anidados con relaciones padre/hijo
3. **Estilizado din√°mico**: Sangr√≠a basada en profundidad
4. **Propagaci√≥n de eventos**: `stopPropagation()` para prevenir burbujeo
5. **useMemo**: Cachear computaciones costosas

### Mejores Pr√°cticas
- ‚úÖ Siempre tener un caso base (prevenir bucles infinitos)
- ‚úÖ Pasar todos los datos necesarios para la recursi√≥n
- ‚úÖ Usar prop `key` en arrays mapeados
- ‚úÖ Optimizar con useMemo para √°rboles grandes
- ‚úÖ Manejar estados vac√≠os (sin hijos)

---

## ¬°M√≥dulo de Categor√≠as Completo! üéâ

Has aprendido:
- ‚úÖ Componentes, props, JSX
- ‚úÖ Listas y keys
- ‚úÖ useState para interactividad
- ‚úÖ Formularios con React Hook Form + Zod
- ‚úÖ Integraci√≥n de API
- ‚úÖ useEffect para efectos secundarios
- ‚úÖ Portales para modales
- ‚úÖ Recursi√≥n para estructuras de √°rbol
- ‚úÖ useMemo para rendimiento

**Pr√≥ximo m√≥dulo:** Hilos (m√°s complejos que las categor√≠as)

Contin√∫a a [M√≥dulo de Hilos ‚Üí](/es/react/5.threads-module/1.list-threads)
