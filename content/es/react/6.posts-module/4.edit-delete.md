---
title: Editar y Eliminar Posts - EdiciÃ³n Inline y EliminaciÃ³n Suave
description: Domina transformaciÃ³n de formulario inline, seguimiento de historial de ediciones, eliminaciÃ³n suave vs dura, verificaciones de permisos y ventanas de ediciÃ³n. Construye ediciÃ³n de posts lista para producciÃ³n.
---

# Disclaimer

:::u-alert
---
title: Los comentarios en el cÃ³digo son solo educativos.
description: En proyectos reales, evita comentarios irrelevantes o redundantes.
color: warning
variant: subtle
icon: i-lucide-triangle-alert
---
:::

Editar y eliminar posts introduce patrones UX complejos: **ediciÃ³n inline** (transformar un post en un formulario), **eliminaciÃ³n suave** (ocultar sin destruir datos), **historial de ediciones** (rastrear cambios), **verificaciones de permisos** (solo el autor puede editar), y **ventanas de ediciÃ³n** (lÃ­mites de tiempo para editar).

---

## QuÃ© Estamos Construyendo

EdiciÃ³n de posts con:
- **EdiciÃ³n inline**: El post se transforma en formulario editable
- **EliminaciÃ³n suave**: Marcar como eliminado, preservar en base de datos
- **Historial de ediciones**: Rastrear todos los cambios con timestamps
- **Verificaciones de permisos**: Solo autor o admin puede editar
- **Ventana de ediciÃ³n**: Ventana de 15 minutos para editar despuÃ©s de publicar
- **Indicadores de cambio**: Mostrar insignia "(editado)" con timestamp
- **DiÃ¡logos de confirmaciÃ³n**: Advertir antes de descartar cambios
- **Soporte markdown**: Editor completo con vista previa

**Flujo Visual:**
```
Post por @alice (hace 2 minutos)
"Â¿CÃ³mo aprendo React?"
[Editar] [Eliminar]

Usuario hace clic en Editar â†’

Post por @alice (hace 2 minutos) (EDITANDO)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Editor Markdown]                    â”‚
â”‚ Â¿CÃ³mo aprendo React?                â”‚
â”‚                                     â”‚
â”‚ [Vista Previa] [Cancelar] [Guardar] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Usuario guarda â†’

Post por @alice (hace 2 minutos) (editado hace un momento)
"Â¿CÃ³mo aprendo React? [Contenido actualizado]"
[Historial de Ediciones]
```

---

## El DesafÃ­o: EdiciÃ³n Inline vs EdiciÃ³n Modal

### Dos Enfoques

**Enfoque 1: Formulario Modal** âŒ
```tsx
<button onClick={() => setShowModal(true)}>Editar</button>
<Modal><EditForm /></Modal>
```

**Problemas:**
- Pierde contexto (no puede ver posts circundantes)
- Disruptivo (modal toma control de pantalla)
- Capa UI extra (mÃ¡s clics)

**Enfoque 2: Formulario Inline** âœ…
```tsx
{isEditing ? (
  <EditForm />
) : (
  <PostContent />
)}
```

**Beneficios:**
- Contexto preservado (ver flujo de conversaciÃ³n)
- No disruptivo (se mantiene en lugar)
- Menos clics (transformaciÃ³n directa)
- Mejor UX mÃ³vil (sin superposiciÃ³n modal)

---

## Sistema de Permisos

### Â¿QuiÃ©n Puede Editar/Eliminar?

```typescript
interface EditPermissions {
  canEdit: boolean
  canDelete: boolean
  reason?: string
}

function getEditPermissions(post: Post, user: User | null): EditPermissions {
  // No ha iniciado sesiÃ³n
  if (!user) {
    return {
      canEdit: false,
      canDelete: false,
      reason: 'Debes iniciar sesiÃ³n',
    }
  }

  // Los admins pueden hacer cualquier cosa
  if (user.role === 'admin') {
    return {
      canEdit: true,
      canDelete: true,
    }
  }

  // No es el autor
  if (post.authorId !== user.id) {
    return {
      canEdit: false,
      canDelete: false,
      reason: 'Solo el autor puede editar este post',
    }
  }

  // Verificar ventana de ediciÃ³n (15 minutos)
  const fifteenMinutesAgo = Date.now() - 15 * 60 * 1000
  const postTimestamp = new Date(post.createdAt).getTime()
  const withinWindow = postTimestamp > fifteenMinutesAgo

  if (!withinWindow) {
    return {
      canEdit: false,
      canDelete: false,
      reason: 'Ventana de ediciÃ³n expirada (15 minutos)',
    }
  }

  // Autor dentro de ventana de ediciÃ³n
  return {
    canEdit: true,
    canDelete: true,
  }
}
```

---

## Componente de Editar Post

```tsx
// src/components/posts/EditablePost.tsx

import { useState } from 'react'
import { useForm } from 'react-hook-form'
import { zodResolver } from '@hookform/resolvers/zod'
import { z } from 'zod'
import { MarkdownEditor } from '@/components/ui/MarkdownEditor'
import { apiClient } from '@/lib/api-client'
import { toast } from '@/lib/toast'
import { useAuth } from '@/contexts/AuthContext'
import type { Post } from '@/types'

const editPostSchema = z.object({
  content: z
    .string()
    .trim()
    .min(10, 'El post debe tener al menos 10 caracteres')
    .max(10000, 'El post debe tener menos de 10,000 caracteres'),
})

type EditPostInput = z.infer<typeof editPostSchema>

interface EditablePostProps {
  post: Post
  onUpdate: (post: Post) => void
  onDelete: () => void
}

/**
 * EditablePost - Post con ediciÃ³n inline
 * 
 * Estados:
 * - VIEW: Mostrar contenido del post con botones editar/eliminar
 * - EDIT: Mostrar formulario inline para editar contenido
 * - CONFIRM_DELETE: Mostrar diÃ¡logo de confirmaciÃ³n
 * 
 * CaracterÃ­sticas:
 * - EdiciÃ³n inline (post se transforma en formulario)
 * - Verificaciones de permisos (solo autor o admin)
 * - AplicaciÃ³n de ventana de ediciÃ³n (15 minutos)
 * - EliminaciÃ³n suave (marcar como eliminado, preservar datos)
 * - Seguimiento de historial de ediciones
 * - ConfirmaciÃ³n de cambios (advertir antes de descartar)
 */
export function EditablePost({ post, onUpdate, onDelete }: EditablePostProps) {
  const { user } = useAuth()
  const [isEditing, setIsEditing] = useState(false)
  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false)
  const [showPreview, setShowPreview] = useState(false)

  /**
   * Verificar permisos
   */
  const permissions = getEditPermissions(post, user)

  /**
   * ConfiguraciÃ³n del formulario
   */
  const {
    register,
    handleSubmit,
    watch,
    formState: { errors, isSubmitting, isDirty },
    reset,
  } = useForm<EditPostInput>({
    resolver: zodResolver(editPostSchema),
    defaultValues: {
      content: post.content,
    },
  })

  const content = watch('content')

  /**
   * Manejar envÃ­o de ediciÃ³n
   */
  const onSubmit = async (data: EditPostInput) => {
    try {
      const response = await apiClient.put<Post>(`/posts/${post.id}`, {
        content: data.content,
      })

      toast.success('Â¡Post actualizado!')
      setIsEditing(false)
      onUpdate(response.data)
    } catch (error) {
      toast.error('FallÃ³ actualizar post')
    }
  }

  /**
   * Manejar cancelaciÃ³n
   * 
   * Si se hicieron cambios, confirmar antes de descartar
   */
  const handleCancel = () => {
    if (isDirty) {
      if (!window.confirm('Â¿Descartar cambios?')) {
        return
      }
    }

    reset()
    setIsEditing(false)
  }

  /**
   * Manejar eliminaciÃ³n
   * 
   * EliminaciÃ³n suave: Marcar como eliminado, preservar en BD
   */
  const handleDelete = async () => {
    try {
      await apiClient.delete(`/posts/${post.id}`)
      toast.success('Post eliminado')
      onDelete()
    } catch (error) {
      toast.error('FallÃ³ eliminar post')
    }
  }

  /**
   * MODO EDICIÃ“N: Mostrar formulario inline
   */
  if (isEditing) {
    return (
      <div className="p-4 bg-slate-900 rounded-lg border border-blue-600">
        {/* Indicador de ediciÃ³n */}
        <div className="mb-3 text-sm text-blue-400">
          Editando post...
        </div>

        {/* Formulario */}
        <form onSubmit={handleSubmit(onSubmit)} className="space-y-4">
          <div>
            <MarkdownEditor
              value={content}
              onChange={(value) => register('content').onChange({ target: { value } })}
              placeholder="Edita tu post..."
              showPreview={showPreview}
              minHeight={120}
            />

            {errors.content && (
              <p className="mt-2 text-sm text-red-400">
                {errors.content.message}
              </p>
            )}
          </div>

          {/* Acciones */}
          <div className="flex items-center justify-between">
            <button
              type="button"
              onClick={() => setShowPreview(!showPreview)}
              className="text-sm text-slate-400 hover:text-slate-200"
            >
              {showPreview ? 'âœï¸ Editar' : 'ğŸ‘ï¸ Vista Previa'}
            </button>

            <div className="flex gap-3">
              <button
                type="button"
                onClick={handleCancel}
                className="px-4 py-2 bg-slate-800 text-slate-200 rounded-lg hover:bg-slate-700"
              >
                Cancelar
              </button>

              <button
                type="submit"
                disabled={isSubmitting || !isDirty}
                className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50"
              >
                {isSubmitting ? 'Guardando...' : 'Guardar Cambios'}
              </button>
            </div>
          </div>
        </form>
      </div>
    )
  }

  /**
   * MODO VISTA: Mostrar contenido del post
   */
  return (
    <div className="p-4 bg-slate-900 rounded-lg border border-slate-800">
      {/* Encabezado del Post */}
      <div className="flex items-start justify-between mb-3">
        <div>
          <span className="font-medium text-slate-100">
            {post.author.username}
          </span>
          <span className="mx-2 text-slate-600">â€¢</span>
          <span className="text-sm text-slate-500">
            {formatRelativeTime(post.createdAt)}
          </span>

          {/* Indicador de editado */}
          {post.editedAt && (
            <>
              <span className="mx-2 text-slate-600">â€¢</span>
              <span className="text-xs text-slate-500">
                (editado {formatRelativeTime(post.editedAt)})
              </span>
            </>
          )}
        </div>

        {/* Botones de acciÃ³n */}
        {permissions.canEdit && (
          <div className="flex gap-2">
            <button
              onClick={() => setIsEditing(true)}
              className="text-sm text-slate-400 hover:text-blue-400"
              title="Editar post"
            >
              Editar
            </button>

            {permissions.canDelete && (
              <button
                onClick={() => setShowDeleteConfirm(true)}
                className="text-sm text-slate-400 hover:text-red-400"
                title="Eliminar post"
              >
                Eliminar
              </button>
            )}
          </div>
        )}
      </div>

      {/* Contenido del Post */}
      {post.isDeleted ? (
        <p className="text-slate-500 italic">[eliminado]</p>
      ) : (
        <div
          className="prose prose-invert max-w-none"
          dangerouslySetInnerHTML={{ __html: post.contentHtml }}
        />
      )}

      {/* ConfirmaciÃ³n de EliminaciÃ³n */}
      {showDeleteConfirm && (
        <div className="mt-4 p-4 bg-red-900/20 border border-red-800 rounded-lg">
          <p className="text-sm text-slate-200 mb-3">
            Â¿EstÃ¡s seguro de que quieres eliminar este post? Esta acciÃ³n no se puede deshacer.
          </p>
          <div className="flex gap-3">
            <button
              onClick={() => setShowDeleteConfirm(false)}
              className="px-4 py-2 bg-slate-800 text-slate-200 rounded-lg hover:bg-slate-700"
            >
              Cancelar
            </button>
            <button
              onClick={handleDelete}
              className="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700"
            >
              Eliminar Post
            </button>
          </div>
        </div>
      )}
    </div>
  )
}

/**
 * Formatear tiempo relativo
 */
function formatRelativeTime(timestamp: string): string {
  const seconds = Math.floor(
    (Date.now() - new Date(timestamp).getTime()) / 1000
  )

  if (seconds < 60) return 'hace un momento'
  if (seconds < 3600) return `hace ${Math.floor(seconds / 60)} minutos`
  if (seconds < 86400) return `hace ${Math.floor(seconds / 3600)} horas`
  return `hace ${Math.floor(seconds / 86400)} dÃ­as`
}
```

---

## Seguimiento de Historial de Ediciones

```tsx
// src/features/posts/components/EditHistory.tsx

interface PostEdit {
  id: string
  postId: string
  content: string
  editedBy: {
    id: string
    username: string
  }
  editedAt: string
}

interface EditHistoryProps {
  postId: string
}

/**
 * EditHistory - Mostrar todas las ediciones de un post
 * 
 * CaracterÃ­sticas:
 * - LÃ­nea de tiempo de cambios
 * - Vista diff (mostrar quÃ© cambiÃ³)
 * - Revertir a versiÃ³n anterior
 * - AtribuciÃ³n del editor
 */
export function EditHistory({ postId }: EditHistoryProps) {
  const [history, setHistory] = useState<PostEdit[]>([])
  const [isLoading, setIsLoading] = useState(true)

  useEffect(() => {
    fetchHistory()
  }, [postId])

  const fetchHistory = async () => {
    try {
      const response = await apiClient.get<PostEdit[]>(
        `/posts/${postId}/history`
      )
      setHistory(response.data)
    } finally {
      setIsLoading(false)
    }
  }

  if (isLoading) return <div>Cargando historial...</div>

  return (
    <div className="space-y-4">
      <h3 className="text-lg font-semibold">Historial de Ediciones</h3>

      {history.map((edit, index) => (
        <div
          key={edit.id}
          className="p-4 bg-slate-900 rounded-lg border border-slate-800"
        >
          <div className="flex items-center justify-between mb-2">
            <div className="text-sm">
              <span className="text-slate-400">Editado por</span>{' '}
              <span className="text-blue-400 font-medium">
                @{edit.editedBy.username}
              </span>
              <span className="mx-2 text-slate-600">â€¢</span>
              <span className="text-slate-500">
                {formatRelativeTime(edit.editedAt)}
              </span>
            </div>

            {index === 0 && (
              <span className="text-xs px-2 py-1 bg-blue-600/20 text-blue-400 rounded">
                Actual
              </span>
            )}
          </div>

          <div className="text-sm text-slate-300">
            {edit.content.slice(0, 200)}
            {edit.content.length > 200 && '...'}
          </div>
        </div>
      ))}
    </div>
  )
}
```

---

## Resumen

### Patrones Clave Aprendidos

1. **EdiciÃ³n Inline**: Transformar componente entre estados
   ```tsx
   {isEditing ? <EditForm /> : <PostContent />}
   ```

2. **Sistema de Permisos**: Verificar usuario, rol y ventana de tiempo
   ```tsx
   const canEdit = isAuthor && withinTimeWindow
   ```

3. **EliminaciÃ³n Suave**: Marcar como eliminado, preservar datos
   ```tsx
   isDeleted ? <span>[eliminado]</span> : <Content />
   ```

4. **Historial de Ediciones**: Rastrear todos los cambios con atribuciÃ³n
   - QuiÃ©n editÃ³
   - CuÃ¡ndo editÃ³
   - QuÃ© cambiÃ³

5. **DiÃ¡logos de ConfirmaciÃ³n**: Prevenir pÃ©rdida accidental de datos
   - Confirmar antes de eliminar
   - Advertir al descartar cambios

### Mejores PrÃ¡cticas

- âœ… Verificar permisos antes de mostrar botones de ediciÃ³n
- âœ… Aplicar ventanas de ediciÃ³n (prevenir abuso)
- âœ… Usar eliminaciÃ³n suave (preservar historial)
- âœ… Rastrear historial de ediciones (transparencia)
- âœ… Mostrar indicador "(editado)"
- âœ… Confirmar antes de acciones destructivas
- âœ… EdiciÃ³n inline para mejor UX
- âœ… Deshabilitar acciones durante envÃ­o

### Consideraciones de Seguridad

- ğŸ”’ Siempre verificar permisos en backend
- ğŸ”’ No confiar en verificaciones de permisos del lado del cliente
- ğŸ”’ Validar ventana de ediciÃ³n en servidor
- ğŸ”’ Registrar todas las ediciones para auditorÃ­a
- ğŸ”’ Limitar tasa de solicitudes de ediciÃ³n
- ğŸ”’ Sanitizar salida HTML (prevenciÃ³n XSS)

---

## Â¡MÃ³dulo de Posts Completo! ğŸ‰

Has dominado:
- âœ… Posts anidados recursivos
- âœ… ComposiciÃ³n de respuestas inline
- âœ… Sistema de votos optimista
- âœ… EdiciÃ³n inline con historial
- âœ… EliminaciÃ³n suave
- âœ… Verificaciones de permisos

---

Siguiente: [MÃ³dulo de AutenticaciÃ³n â†’](/es/react/7.auth-module/1.signup-signin)
